<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Mysql5.7RDS还原教程</title>
    <link href="/2021/04/28/MysqlRDS%E8%BF%98%E5%8E%9F%E6%95%99%E7%A8%8B/"/>
    <url>/2021/04/28/MysqlRDS%E8%BF%98%E5%8E%9F%E6%95%99%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="Mysql5-7RDS还原教程"><a href="#Mysql5-7RDS还原教程" class="headerlink" title="Mysql5.7RDS还原教程"></a>Mysql5.7RDS还原教程</h1><ul><li><p>环境准备</p><p>使用的是Linux Centos7环境，还原前请确保mysql环境卸载干净</p><p>innobackupex解压命令需要安装qpress，使用如下命令安装：</p><figure class="highlight css"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs css"><span class="hljs-selector-tag">wget</span> &quot;<span class="hljs-selector-tag">http</span>://<span class="hljs-selector-tag">docs-aliyun</span><span class="hljs-selector-class">.cn-hangzhou</span><span class="hljs-selector-class">.oss</span><span class="hljs-selector-class">.aliyun-inc</span><span class="hljs-selector-class">.com</span>/<span class="hljs-selector-tag">assets</span>/<span class="hljs-selector-tag">attach</span>/183466/<span class="hljs-selector-tag">cn_zh</span>/1608011575185/<span class="hljs-selector-tag">qpress-11-linux-x64</span><span class="hljs-selector-class">.tar</span>&quot;<br><span class="hljs-selector-tag">tar</span> <span class="hljs-selector-tag">xvf</span> <span class="hljs-selector-tag">qpress-11-linux-x64</span><span class="hljs-selector-class">.tar</span><br><span class="hljs-selector-tag">chmod</span> 775 <span class="hljs-selector-tag">qpress</span><br><span class="hljs-selector-tag">cp</span> <span class="hljs-selector-tag">qpress</span> /<span class="hljs-selector-tag">usr</span>/<span class="hljs-selector-tag">bin</span><br></code></pre></div></td></tr></table></figure><p>根据需要还原的Mysql镜像版本下载相应的工具，我需要还原的MySQL版本为5.7，所以下载Percona-XtraBackup-2.4。</p><figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">wget</span> ftp://rpmfind.net/linux/atrpms/el<span class="hljs-number">6</span>-x<span class="hljs-number">86</span>_<span class="hljs-number">64</span>/atrpms/stable/libev-<span class="hljs-number">4</span>.<span class="hljs-number">04</span>-<span class="hljs-number">2</span>.el<span class="hljs-number">6</span>.x<span class="hljs-number">86</span>_<span class="hljs-number">64</span>.rpm<br><span class="hljs-attribute">rpm</span> -ivh libev-<span class="hljs-number">4</span>.<span class="hljs-number">04</span>-<span class="hljs-number">2</span>.el<span class="hljs-number">6</span>.x<span class="hljs-number">86</span>_<span class="hljs-number">64</span>.rpm<br><span class="hljs-attribute">wget</span> https://downloads.percona.com/downloads/Percona-XtraBackup-<span class="hljs-number">2</span>.<span class="hljs-number">4</span>/Percona-XtraBackup-<span class="hljs-number">2</span>.<span class="hljs-number">4</span>.<span class="hljs-number">21</span>/binary/redhat/<span class="hljs-number">7</span>/x<span class="hljs-number">86</span>_<span class="hljs-number">64</span>/percona-xtrabackup-<span class="hljs-number">24</span>-<span class="hljs-number">2</span>.<span class="hljs-number">4</span>.<span class="hljs-number">21</span>-<span class="hljs-number">1</span>.el<span class="hljs-number">7</span>.x<span class="hljs-number">86</span>_<span class="hljs-number">64</span>.rpm<br><span class="hljs-attribute">yum</span> install -y wget net-tools rsync perl-DBD-MySQL perl-Digest-MD<span class="hljs-number">5</span><br><span class="hljs-attribute">rpm</span> -ivh percona-xtrabackup-<span class="hljs-number">24</span>-<span class="hljs-number">2</span>.<span class="hljs-number">4</span>.<span class="hljs-number">21</span>-<span class="hljs-number">1</span>.el<span class="hljs-number">7</span>.x<span class="hljs-number">86</span>_<span class="hljs-number">64</span>.rpm<br></code></pre></div></td></tr></table></figure><p>先对镜像进行解包，在对镜像解密：</p><figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk"><span class="hljs-comment">## 解包</span><br>cat &lt;数据备份文件名&gt; | xbstream -x -v -C <span class="hljs-regexp">/home/my</span>sql/data<br><span class="hljs-comment">## 解密</span><br>innobackupex --decompress --remove-original <span class="hljs-regexp">/home/my</span>sql/data<br></code></pre></div></td></tr></table></figure><p>查看解密后的文件：</p><figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">ls -l <span class="hljs-regexp">/home/my</span>sql/data<br></code></pre></div></td></tr></table></figure><p><img src="https://gitee.com/lycgd/common_-gallery/raw/master/p47410.jpg" srcset="/img/loading.gif" alt="查看解压文件"></p><p>恢复解压好的备份文件：</p><figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk"><span class="hljs-comment">## MySQL 5.6/5.7</span><br>innobackupex --defaults-file=<span class="hljs-regexp">/home/my</span>sql<span class="hljs-regexp">/data/</span>backup-my.cnf --apply-log <span class="hljs-regexp">/home/my</span>sql/data<br></code></pre></div></td></tr></table></figure><p>返回如下结果，说明恢复成功：</p><p><img src="https://gitee.com/lycgd/common_-gallery/raw/master/image-20210428162950556.png" srcset="/img/loading.gif" alt="image-20210428162950556"></p></li></ul><h1 id="安装Mysql"><a href="#安装Mysql" class="headerlink" title="安装Mysql"></a>安装Mysql</h1><figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk"><span class="hljs-comment">## 查看安装的MariaDB列表</span><br>rpm -qa | grep mariadb<br><span class="hljs-comment">## 删除有的</span><br>rpm -e --nodeps <br><span class="hljs-comment">## 解压</span><br>tar -zxvf mysql-<span class="hljs-number">5.7</span>.<span class="hljs-number">28</span>-linux-glibc2.<span class="hljs-number">12</span>-x86_64.tar.gz<br><span class="hljs-comment">## 创建文件夹</span><br>mkdir <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/mysql/</span><br><span class="hljs-comment">## 重命名文件夹</span><br>mv mysql-<span class="hljs-number">5.7</span>.<span class="hljs-number">28</span>-linux-glibc2.<span class="hljs-number">12</span>-x86_64 <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/mysql/my</span>sql-<span class="hljs-number">5.7</span>.<span class="hljs-number">28</span><br><span class="hljs-comment">## 创建Linux用户</span><br>groupadd mysql<br>useradd -r -g mysql mysql<br><span class="hljs-comment">## 更改文件归属</span><br>chown -R mysql <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/mysql/my</span>sql-<span class="hljs-number">5.7</span>.<span class="hljs-number">28</span>/<br>chgrp -R mysql <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/mysql/my</span>sql-<span class="hljs-number">5.7</span>.<span class="hljs-number">28</span>/<br><span class="hljs-comment">## 配置数据库文件</span><br>[mysqld]<br>datadir=<span class="hljs-regexp">/home/my</span>sql/data<br>basedir=<span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/mysql/my</span>sql-<span class="hljs-number">5.7</span>.<span class="hljs-number">28</span><br>socket=<span class="hljs-regexp">/tmp/my</span>sql.sock<br>user=mysql<br>port=<span class="hljs-number">3306</span><br>character-set-server=utf8<br>skip-grant-tables<br>symbolic-links=<span class="hljs-number">0</span><br>[mysqld_safe]<br>log-error=<span class="hljs-regexp">/var/</span>log/mysqld.log<br>pid-file=<span class="hljs-regexp">/var/</span>run<span class="hljs-regexp">/mysqld/my</span>sqld.pid<br><span class="hljs-comment">## 配置环境变量</span><br>export PATH=<span class="hljs-variable">$PATH</span>:<span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/mysql/my</span>sql-<span class="hljs-number">5.7</span>.<span class="hljs-number">28</span>/bin<br><span class="hljs-comment">## 修改权限</span><br>chown -R mysql:mysql <span class="hljs-regexp">/home/my</span>sql<span class="hljs-regexp">/data/</span><br><span class="hljs-comment">## 启动MySQL</span><br>.<span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/mysql/my</span>sql-<span class="hljs-number">5.7</span>.<span class="hljs-number">28</span><span class="hljs-regexp">/support-files/my</span>sql.server start<br><span class="hljs-comment">## 修改密码</span><br>update mysql.user set authentication_string=password(<span class="hljs-string">&#x27;root&#x27;</span>) where user=<span class="hljs-string">&#x27;root&#x27;</span>;<br>flush privileges;<br><span class="hljs-comment">## 开启远程登录</span><br>GRANT ALL PRIVILEGES ON *.* TO <span class="hljs-string">&#x27;root&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="hljs-string">&#x27;root&#x27;</span> WITH GRANT OPTION;<br>flush privileges;<br><span class="hljs-comment">## 关闭防火墙</span><br>systemctl stop firewalld<br></code></pre></div></td></tr></table></figure><h1 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h1><figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk"><span class="hljs-comment">## Mysql5.7修改用户密码，报错“Unknown trigger has an error in its body: ‘Unknown system variable ‘maintain_user”</span><br><span class="hljs-comment">## 解决方法</span><br><span class="hljs-comment">## 查询并删除触发器</span><br>select trigger_schema,trigger_name from information_schema.triggers;<br>drop trigger sys.sys_config_insert_set_user;<br>drop trigger sys.sys_config_update_set_user;<br><span class="hljs-comment">## 修改.trg结尾触发器文件</span><br>find <span class="hljs-regexp">/home/my</span>sql<span class="hljs-regexp">/data/</span> -iname *.trg<br>mv <span class="hljs-regexp">/home/my</span>sql<span class="hljs-regexp">/data/my</span>sql<span class="hljs-regexp">/proxies_priv.TRG /</span>home<span class="hljs-regexp">/mysql/</span>data<span class="hljs-regexp">/mysql/</span>proxies_priv.TRG.back<br>mv <span class="hljs-regexp">/home/my</span>sql<span class="hljs-regexp">/data/my</span>sql<span class="hljs-regexp">/user.TRG /</span>home<span class="hljs-regexp">/mysql/</span>data<span class="hljs-regexp">/mysql/u</span>ser.TRG.back<br></code></pre></div></td></tr></table></figure><p><img src="https://gitee.com/lycgd/common_-gallery/raw/master/20210428195201.png" srcset="/img/loading.gif" alt="image-20210428195027053"></p>]]></content>
    
    
    
    <tags>
      
      <tag>MySQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQL开启查询日志</title>
    <link href="/2021/03/23/mysql-log/"/>
    <url>/2021/03/23/mysql-log/</url>
    
    <content type="html"><![CDATA[<p>查询日志功能是否开启<br><code>SHOW VARIABLES LIKE &#39;general%&#39;;</code><br>general_log：日志功能是否开启，默认关闭OFF</p><p>general_log_file：日志文件保存位置</p><p>开启日志<br><code>set GLOBAL general_log=&#39;ON&#39;;</code><br>查询是否开启<br><code>SHOW VARIABLES LIKE &#39;general_log&#39;;</code></p>]]></content>
    
    
    
    <tags>
      
      <tag>MySQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hello World</title>
    <link href="/2021/01/12/hello-world/"/>
    <url>/2021/01/12/hello-world/</url>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></div></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">$ hexo server<br></code></pre></div></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">$ hexo generate<br></code></pre></div></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">$ hexo deploy<br></code></pre></div></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
